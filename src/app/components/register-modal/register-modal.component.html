<div class="modal-backdrop" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
        <h2>Registrarse</h2>
        <button class="close-button" (click)="closeModal()">×</button>
    </div>
    <div class="modal-body">
        <form [formGroup]="registerForm" (ngSubmit)="handleSubmit()">
        <div class="form-group">
            <label for="nombres">Nombres</label>
            <input 
            class="register-input"
            type="text" 
            id="nombres" 
            formControlName="nombres"
            placeholder="Ingrese sus nombres"
            [class.error]="isFieldInvalid('nombres')"
            >
            <div class="field-error" *ngIf="isFieldInvalid('nombres')">
            <span *ngIf="registerForm.get('nombres')?.errors?.['required']">
                El nombre es requerido
            </span>
            <span *ngIf="registerForm.get('nombres')?.errors?.['minlength']">
                El nombre debe tener al menos 2 caracteres
            </span>
            </div>
        </div>

        <div class="form-group">
            <label for="apellidos">Apellidos</label>
            <input 
            class="register-input"
            type="text" 
            id="apellidos" 
            formControlName="apellidos"
            placeholder="Ingrese sus apellidos"
            [class.error]="isFieldInvalid('apellidos')"
            >
            <div class="field-error" *ngIf="isFieldInvalid('apellidos')">
            <span *ngIf="registerForm.get('apellidos')?.errors?.['required']">
                Los apellidos son requeridos
            </span>
            <span *ngIf="registerForm.get('apellidos')?.errors?.['minlength']">
                Los apellidos deben tener al menos 2 caracteres
            </span>
            </div>
        </div>

        <div class="form-group">
            <label for="telefono">Teléfono</label>
            <input 
            class="register-input"
            type="tel" 
            id="telefono" 
            formControlName="telefono"
            placeholder="Ingrese su teléfono"
            [class.error]="isFieldInvalid('telefono')"
            >
            <div class="field-error" *ngIf="isFieldInvalid('telefono')">
            <span *ngIf="registerForm.get('telefono')?.errors?.['required']">
                El teléfono es requerido
            </span>
            <span *ngIf="registerForm.get('telefono')?.errors?.['pattern']">
                Formato de teléfono inválido
            </span>
            </div>
        </div>

        <div class="form-group">
            <label for="email">Correo Electrónico</label>
            <input 
            class="register-input"
            type="email" 
            id="email" 
            formControlName="email"
            placeholder="ejemplo@correo.com"
            [class.error]="isFieldInvalid('email')"
            >
            <div class="field-error" *ngIf="isFieldInvalid('email')">
            <span *ngIf="registerForm.get('email')?.errors?.['required']">
                El correo electrónico es requerido
            </span>
            <span *ngIf="registerForm.get('email')?.errors?.['email']">
                Formato de correo electrónico inválido
            </span>
            </div>
        </div>

        <div class="form-group">
            <label for="password">Contraseña</label>
            <input 
            class="register-input"
            type="password" 
            id="password" 
            formControlName="password"
            placeholder="••••••••"
            [class.error]="isFieldInvalid('password')"
            >
            <div class="field-error" *ngIf="isFieldInvalid('password')">
            <span *ngIf="registerForm.get('password')?.errors?.['required']">
                La contraseña es requerida
            </span>
            <span *ngIf="registerForm.get('password')?.errors?.['minlength']">
                La contraseña debe tener al menos 6 caracteres
            </span>
            <span *ngIf="registerForm.get('password')?.errors?.['pattern']">
                La contraseña debe contener al menos una letra mayúscula, una minúscula y un número
            </span>
            </div>
        </div>

        <div class="form-group">
            <label for="confirmPassword">Confirmar Contraseña</label>
            <input 
            class="register-input"
            type="password" 
            id="confirmPassword" 
            formControlName="confirmPassword"
            placeholder="••••••••"
            [class.error]="isFieldInvalid('confirmPassword')"
            >
            <div class="field-error" *ngIf="isFieldInvalid('confirmPassword')">
            <span *ngIf="registerForm.get('confirmPassword')?.errors?.['required']">
                La confirmación de contraseña es requerida
            </span>
            <span *ngIf="registerForm.get('confirmPassword')?.errors?.['passwordMismatch']">
                Las contraseñas no coinciden
            </span>
            </div>
        </div>

        <div class="form-group">
            <label for="especialidad">Especialidad</label>
            <select 
            id="especialidad" 
            class="register-input"
            formControlName="esp_id"
            [class.error]="isFieldInvalid('esp_id')"
            >
            <option value="">Seleccione una especialidad</option>
            <option *ngFor="let esp of especialidades" [value]="esp.id">
                {{ esp.nombre }}
            </option>
            </select>
            <div class="field-error" *ngIf="isFieldInvalid('esp_id')">
            Debe seleccionar una especialidad
            </div>
        </div>

        <div class="error-message" *ngIf="showError">
            {{ errorMessage }}
        </div>

        <div class="form-footer">
            <button 
            type="submit" 
            class="register-button" 
            [disabled]="registerForm.invalid || isLoading"
            >
            {{ isLoading ? 'Registrando...' : 'Registrarse' }}
            </button>
        </div>
        </form>
    </div>
    </div>
</div>